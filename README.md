# Image Analysis API

FastAPI backend service for mobile image upload and AI-powered skin analysis.

## Quick Start

```bash

source setup.sh
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

Visit http://localhost:8000/api/v1/docs

## Installation

**Automated (Recommended):**
```bash
source setup.sh
```

**Manual:**
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cp .env.example .env

# Generate API key
python -c "import secrets; print(secrets.token_urlsafe(32))"
# Copy the output and paste it as API_KEY in .env
```

## Running

```bash
source venv/bin/activate
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

API: http://localhost:8000
Docs: http://localhost:8000/api/v1/docs

## Authentication

**Swagger UI:**
1. Visit http://localhost:8000/api/v1/docs
2. Click **Authorize** button (ðŸ”“)
3. Enter API key from `.env` file

**cURL:**
```bash
-H "X-API-Key: your-api-key"
```

## API Endpoints

### POST /api/v1/upload
Upload an image (JPEG/PNG, max 5MB)

```bash
curl -X POST "http://localhost:8000/api/v1/upload" \
  -H "X-API-Key: your-api-key" \
  -F "file=@image.jpg"
```

### POST /api/v1/analyze
Analyze an uploaded image

```bash
curl -X POST "http://localhost:8000/api/v1/analyze" \
  -H "X-API-Key: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{"image_id":"abc123-def456"}'
```

### GET /health
Health check (no auth required)

## Project Structure

```
app/
â”œâ”€â”€ main.py              # FastAPI app
â”œâ”€â”€ config.py            # Environment config
â”œâ”€â”€ models/              # Pydantic schemas
â”œâ”€â”€ routes/              # API endpoints
â”œâ”€â”€ services/            # Business logic
â”œâ”€â”€ middleware/          # Auth & logging
â””â”€â”€ utils/               # Validators & helpers
```

## Configuration

Edit `.env` file (auto-generated by `setup.sh`):
- `API_KEY` - Authentication key
- `MAX_FILE_SIZE` - Upload limit (default: 5MB)
- `LOG_LEVEL` - Logging level

## Features

- âœ… Image upload validation (JPEG/PNG, 5MB limit)
- âœ… Mock skin analysis with detailed results
- âœ… API key authentication
- âœ… Swagger UI documentation
- âœ… Structured logging with correlation IDs
- âœ… CORS support for mobile apps

## Docker

**Build image:**
```bash
docker build -t image-analysis-api .
```

**Run container:**
```bash
docker run -d \
  -p 8000:8000 \
  -e API_KEY="your-api-key-here" \
  -e LOG_LEVEL="INFO" \
  --name image-api \
  image-analysis-api
```

**Generate API key for Docker:**
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

**Check logs:**
```bash
docker logs image-api
```

**Stop container:**
```bash
docker stop image-api
docker rm image-api
```

The Dockerfile uses multi-stage build for optimized image size and includes health checks.
